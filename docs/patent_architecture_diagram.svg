<?xml version="1.0" encoding="UTF-8"?>
<svg width="1600" height="2000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box { fill: white; stroke: black; stroke-width: 2; }
      .dashed-box { fill: none; stroke: black; stroke-width: 2; stroke-dasharray: 8,4; }
      .thick-box { fill: white; stroke: black; stroke-width: 3; }
      .title { font-family: Arial, sans-serif; font-size: 14px; fill: black; font-weight: bold; text-anchor: middle; }
      .section-title { font-family: Arial, sans-serif; font-size: 20px; fill: black; font-weight: bold; text-anchor: middle; }
      .layer-title { font-family: Arial, sans-serif; font-size: 16px; fill: black; font-weight: bold; text-anchor: middle; }
      .small-text { font-family: Arial, sans-serif; font-size: 11px; fill: black; }
      .ref-text { font-family: Arial, sans-serif; font-size: 10px; fill: black; font-style: italic; }
      .arrow { stroke: black; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .bi-arrow { stroke: black; stroke-width: 2; fill: none; marker-end: url(#arrowhead); marker-start: url(#arrowhead-reverse); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="black" />
    </marker>
    <marker id="arrowhead-reverse" markerWidth="10" markerHeight="10" refX="1" refY="3" orient="auto">
      <polygon points="10 0, 0 3, 10 6" fill="black" />
    </marker>
  </defs>

  <!-- Main System Container -->
  <rect class="thick-box" x="50" y="30" width="1500" height="1940" />
  <text class="section-title" x="800" y="60">SENIOR NAVIGATOR SYSTEM ARCHITECTURE (1000)</text>

  <!-- ==================== LAYER 1: PRESENTATION ==================== -->
  <rect class="dashed-box" x="80" y="100" width="1440" height="240" />
  <text class="layer-title" x="800" y="125">PRESENTATION LAYER (1100)</text>

  <!-- User Interface Component -->
  <rect class="box" x="110" y="150" width="320" height="170" />
  <text class="title" x="270" y="175">USER INTERFACE</text>
  <text class="ref-text" x="270" y="190">(1110)</text>
  <text class="small-text" x="130" y="215">• Streamlit Web Framework</text>
  <text class="small-text" x="130" y="235">• Dynamic Page Routing (1112)</text>
  <text class="small-text" x="130" y="255">• Session State Management (1114)</text>
  <text class="small-text" x="130" y="275">• Component Library (1116)</text>
  <text class="small-text" x="130" y="295">• Responsive Layouts</text>

  <!-- Navigation Hub Component -->
  <rect class="box" x="460" y="150" width="320" height="170" />
  <text class="title" x="620" y="175">NAVIGATION HUB</text>
  <text class="ref-text" x="620" y="190">(1120)</text>
  <text class="small-text" x="480" y="215">• Hub Engine (1122)</text>
  <text class="small-text" x="480" y="235">• Product Tiles (1124)</text>
  <text class="small-text" x="480" y="255">• Journey Routing (1126)</text>
  <text class="small-text" x="480" y="275">• Completion Tracking</text>
  <text class="small-text" x="480" y="295">• Conditional Display</text>

  <!-- Navi Assistant Component -->
  <rect class="box" x="810" y="150" width="320" height="170" />
  <text class="title" x="970" y="175">NAVI ASSISTANT</text>
  <text class="ref-text" x="970" y="190">(1130)</text>
  <text class="small-text" x="830" y="215">• Context-Aware Panel (1132)</text>
  <text class="small-text" x="830" y="235">• Encouragement System (1134)</text>
  <text class="small-text" x="830" y="255">• Progress Visualization (1136)</text>
  <text class="small-text" x="830" y="275">• Adaptive Messaging</text>
  <text class="small-text" x="830" y="295">• Brand Integration</text>

  <!-- Visualization Engine Component -->
  <rect class="box" x="1160" y="150" width="320" height="170" />
  <text class="title" x="1320" y="175">VISUALIZATION ENGINE</text>
  <text class="ref-text" x="1320" y="190">(1140)</text>
  <text class="small-text" x="1180" y="215">• Donut Charts (1142)</text>
  <text class="small-text" x="1180" y="235">• Cost Breakdowns (1144)</text>
  <text class="small-text" x="1180" y="255">• Progress Indicators (1146)</text>
  <text class="small-text" x="1180" y="275">• Interactive Graphs</text>
  <text class="small-text" x="1180" y="295">• Real-Time Updates</text>

  <!-- ==================== LAYER 2: PRODUCT ==================== -->
  <rect class="dashed-box" x="80" y="370" width="1440" height="280" />
  <text class="layer-title" x="800" y="395">PRODUCT LAYER (1200)</text>

  <!-- Guided Care Plan -->
  <rect class="box" x="110" y="420" width="320" height="210" />
  <text class="title" x="270" y="445">GUIDED CARE PLAN</text>
  <text class="ref-text" x="270" y="460">(1210)</text>
  <text class="small-text" x="130" y="485">Module Engine (1212)</text>
  <text class="small-text" x="130" y="505">• 5-Section Assessment</text>
  <text class="small-text" x="130" y="525">• Scoring System (1214)</text>
  <text class="small-text" x="130" y="545">• Gate Logic (1216)</text>
  <text class="small-text" x="150" y="565">- Cognitive Gate</text>
  <text class="small-text" x="150" y="585">- Behavioral Gate</text>
  <text class="small-text" x="130" y="605">• Tier Recommendation (1218)</text>

  <!-- Cost Planner -->
  <rect class="box" x="460" y="420" width="320" height="210" />
  <text class="title" x="620" y="445">COST PLANNER</text>
  <text class="ref-text" x="620" y="460">(1220)</text>
  <text class="small-text" x="480" y="485">Quick Estimate (1222)</text>
  <text class="small-text" x="480" y="505">• Multi-Tier Tabs</text>
  <text class="small-text" x="480" y="525">• Regional Pricing (1224)</text>
  <text class="small-text" x="480" y="545">• Flag Modifiers (1226)</text>
  <text class="small-text" x="480" y="565">Financial Modules (1228)</text>
  <text class="small-text" x="480" y="585">• Income/Asset Assessment</text>
  <text class="small-text" x="480" y="605">• Benefits Navigator</text>

  <!-- Discovery Learning -->
  <rect class="box" x="810" y="420" width="320" height="210" />
  <text class="title" x="970" y="445">DISCOVERY LEARNING</text>
  <text class="ref-text" x="970" y="460">(1230)</text>
  <text class="small-text" x="830" y="485">Education Engine (1232)</text>
  <text class="small-text" x="830" y="505">• Topic Library</text>
  <text class="small-text" x="830" y="525">• Care Type Education</text>
  <text class="small-text" x="830" y="545">• Cost Understanding</text>
  <text class="small-text" x="830" y="565">Progress Tracking (1234)</text>
  <text class="small-text" x="830" y="585">• Quiz Validation</text>
  <text class="small-text" x="830" y="605">• Completion Badges</text>

  <!-- Facility Finder -->
  <rect class="box" x="1160" y="420" width="320" height="210" />
  <text class="title" x="1320" y="445">FACILITY FINDER</text>
  <text class="ref-text" x="1320" y="460">(1240)</text>
  <text class="small-text" x="1180" y="485">Search Engine (1242)</text>
  <text class="small-text" x="1180" y="505">• Location-Based Search</text>
  <text class="small-text" x="1180" y="525">• Advanced Filters (1244)</text>
  <text class="small-text" x="1180" y="545">• Match Scoring (1246)</text>
  <text class="small-text" x="1180" y="565">Partner Integration (1248)</text>
  <text class="small-text" x="1180" y="585">• Contact Management</text>
  <text class="small-text" x="1180" y="605">• Tour Scheduling</text>

  <!-- ==================== LAYER 3: INTELLIGENCE ==================== -->
  <rect class="dashed-box" x="80" y="680" width="1440" height="280" />
  <text class="layer-title" x="800" y="705">INTELLIGENCE & ORCHESTRATION LAYER (1300)</text>

  <!-- LLM Engine -->
  <rect class="box" x="110" y="730" width="440" height="210" />
  <text class="title" x="330" y="755">LLM ENGINE</text>
  <text class="ref-text" x="330" y="770">(1310)</text>
  <text class="small-text" x="130" y="795">OpenAI Integration (1312)</text>
  <text class="small-text" x="130" y="815">• GPT-4o-mini Model</text>
  <text class="small-text" x="130" y="835">• Prompt Templates (1314)</text>
  <text class="small-text" x="130" y="855">• Context Management</text>
  <text class="small-text" x="130" y="875">Policy Mediator (1316)</text>
  <text class="small-text" x="130" y="895">• Guardrails & Validation</text>
  <text class="small-text" x="130" y="915">• Tier Recommendation Logic</text>

  <!-- MCIP Coordinator -->
  <rect class="box" x="580" y="730" width="440" height="210" />
  <text class="title" x="800" y="755">MCIP COORDINATOR</text>
  <text class="ref-text" x="800" y="770">(1320)</text>
  <text class="small-text" x="600" y="795">Multi-Channel Integration (1322)</text>
  <text class="small-text" x="600" y="815">• Product State Tracking</text>
  <text class="small-text" x="600" y="835">• Outcome Aggregation (1324)</text>
  <text class="small-text" x="600" y="855">• Completion Detection</text>
  <text class="small-text" x="600" y="875">Cross-Product Orchestration (1326)</text>
  <text class="small-text" x="600" y="895">• Journey Management</text>
  <text class="small-text" x="600" y="915">• Event Distribution</text>

  <!-- Flag Manager -->
  <rect class="box" x="1050" y="730" width="430" height="210" />
  <text class="title" x="1265" y="755">FLAG MANAGER</text>
  <text class="ref-text" x="1265" y="770">(1330)</text>
  <text class="small-text" x="1070" y="795">Flag Registry (1332)</text>
  <text class="small-text" x="1070" y="815">• Care Flags (Dementia, Mobility)</text>
  <text class="small-text" x="1070" y="835">• Risk Indicators</text>
  <text class="small-text" x="1070" y="855">• Support Need Markers</text>
  <text class="small-text" x="1070" y="875">Activation Engine (1334)</text>
  <text class="small-text" x="1070" y="895">• Conditional Logic</text>
  <text class="small-text" x="1070" y="915">• Priority Scoring</text>

  <!-- ==================== LAYER 4: DATA & PERSISTENCE ==================== -->
  <rect class="dashed-box" x="80" y="990" width="1440" height="280" />
  <text class="layer-title" x="800" y="1015">DATA & PERSISTENCE LAYER (1400)</text>

  <!-- Session Store -->
  <rect class="box" x="110" y="1040" width="320" height="210" />
  <text class="title" x="270" y="1065">SESSION STORE</text>
  <text class="ref-text" x="270" y="1080">(1410)</text>
  <text class="small-text" x="130" y="1105">State Management (1412)</text>
  <text class="small-text" x="130" y="1125">• User Session State</text>
  <text class="small-text" x="130" y="1145">• Product State</text>
  <text class="small-text" x="130" y="1165">• Journey State</text>
  <text class="small-text" x="130" y="1185">Persistence Layer (1414)</text>
  <text class="small-text" x="130" y="1205">• Extraction Keys</text>
  <text class="small-text" x="130" y="1225">• Migration Support</text>

  <!-- User Persistence -->
  <rect class="box" x="460" y="1040" width="320" height="210" />
  <text class="title" x="620" y="1065">USER PERSISTENCE</text>
  <text class="ref-text" x="620" y="1080">(1420)</text>
  <text class="small-text" x="480" y="1105">Profile Storage (1422)</text>
  <text class="small-text" x="480" y="1125">• User ID Generation</text>
  <text class="small-text" x="480" y="1145">• Secure Hashing</text>
  <text class="small-text" x="480" y="1165">Data Payloads (1424)</text>
  <text class="small-text" x="480" y="1185">• GCP Outcomes</text>
  <text class="small-text" x="480" y="1205">• Cost Plans</text>
  <text class="small-text" x="480" y="1225">• Decision History</text>

  <!-- Configuration Store -->
  <rect class="box" x="810" y="1040" width="320" height="210" />
  <text class="title" x="970" y="1065">CONFIGURATION</text>
  <text class="ref-text" x="970" y="1080">(1430)</text>
  <text class="small-text" x="830" y="1105">Static Configuration (1432)</text>
  <text class="small-text" x="830" y="1125">• Module Definitions (JSON)</text>
  <text class="small-text" x="830" y="1145">• Regional Cost Data</text>
  <text class="small-text" x="830" y="1165">• Feature Flags</text>
  <text class="small-text" x="830" y="1185">Dynamic Configuration (1434)</text>
  <text class="small-text" x="830" y="1205">• FAQ Library</text>
  <text class="small-text" x="830" y="1225">• Partner Database</text>

  <!-- Training Data -->
  <rect class="box" x="1160" y="1040" width="320" height="210" />
  <text class="title" x="1320" y="1065">TRAINING DATA</text>
  <text class="ref-text" x="1320" y="1080">(1440)</text>
  <text class="small-text" x="1180" y="1105">Case Logging (1442)</text>
  <text class="small-text" x="1180" y="1125">• GCP Assessment Cases</text>
  <text class="small-text" x="1180" y="1145">• Care Hours Cases</text>
  <text class="small-text" x="1180" y="1165">• Decision Tracking</text>
  <text class="small-text" x="1180" y="1185">Analysis Engine (1444)</text>
  <text class="small-text" x="1180" y="1205">• Agreement Metrics</text>
  <text class="small-text" x="1180" y="1225">• Model Improvement</text>

  <!-- ==================== LAYER 5: EXTERNAL INTEGRATION ==================== -->
  <rect class="dashed-box" x="80" y="1300" width="1440" height="150" />
  <text class="layer-title" x="800" y="1325">EXTERNAL INTEGRATION LAYER (1500)</text>

  <!-- OpenAI API -->
  <rect class="box" x="110" y="1355" width="320" height="70" />
  <text class="title" x="270" y="1380">OPENAI API</text>
  <text class="ref-text" x="270" y="1395">(1510)</text>
  <text class="small-text" x="130" y="1415">GPT-4o-mini Endpoint</text>

  <!-- Secrets Management -->
  <rect class="box" x="460" y="1355" width="320" height="70" />
  <text class="title" x="620" y="1380">SECRETS MANAGEMENT</text>
  <text class="ref-text" x="620" y="1395">(1520)</text>
  <text class="small-text" x="480" y="1415">API Keys & Credentials</text>

  <!-- Regional Data Source -->
  <rect class="box" x="810" y="1355" width="320" height="70" />
  <text class="title" x="970" y="1380">REGIONAL DATA</text>
  <text class="ref-text" x="970" y="1395">(1530)</text>
  <text class="small-text" x="830" y="1415">Cost Multiplier Database</text>

  <!-- Partner Systems -->
  <rect class="box" x="1160" y="1355" width="320" height="70" />
  <text class="title" x="1320" y="1380">PARTNER SYSTEMS</text>
  <text class="ref-text" x="1320" y="1395">(1540)</text>
  <text class="small-text" x="1180" y="1415">Facility Data Integration</text>

  <!-- ==================== DATA FLOW SECTION ==================== -->
  <rect class="dashed-box" x="80" y="1480" width="1440" height="460" />
  <text class="layer-title" x="800" y="1505">KEY SYSTEM FLOWS (1600)</text>

  <!-- User Journey Flow -->
  <rect class="box" x="110" y="1530" width="700" height="180" />
  <text class="title" x="460" y="1555">USER JOURNEY FLOW (1610)</text>
  
  <rect class="box" x="140" y="1580" width="130" height="50" />
  <text class="small-text" x="180" y="1610">Hub Entry</text>
  <text class="ref-text" x="205" y="1622">(1611)</text>
  
  <line class="arrow" x1="270" y1="1605" x2="310" y2="1605" />
  
  <rect class="box" x="310" y="1580" width="130" height="50" />
  <text class="small-text" x="360" y="1610">GCP</text>
  <text class="ref-text" x="375" y="1622">(1612)</text>
  
  <line class="arrow" x1="440" y1="1605" x2="480" y2="1605" />
  
  <rect class="box" x="480" y="1580" width="130" height="50" />
  <text class="small-text" x="515" y="1610">Cost Planner</text>
  <text class="ref-text" x="545" y="1622">(1614)</text>
  
  <line class="arrow" x1="610" y1="1605" x2="650" y2="1605" />
  
  <rect class="box" x="650" y="1580" width="130" height="50" />
  <text class="small-text" x="690" y="1610">Discovery</text>
  <text class="ref-text" x="715" y="1622">(1616)</text>
  
  <text class="small-text" x="140" y="1660">MCIP tracks completion state across products (1618)</text>
  <text class="small-text" x="140" y="1680">Session state persists through entire journey (1619)</text>

  <!-- LLM Integration Flow -->
  <rect class="box" x="840" y="1530" width="640" height="180" />
  <text class="title" x="1160" y="1555">LLM INTEGRATION FLOW (1620)</text>
  
  <text class="small-text" x="860" y="1585">1. User completes assessment (1621)</text>
  <text class="small-text" x="860" y="1605">2. Deterministic engine calculates tier (1622)</text>
  <text class="small-text" x="860" y="1625">3. LLM called via policy mediator (1624)</text>
  <text class="small-text" x="860" y="1645">4. Guardrails validate LLM output (1626)</text>
  <text class="small-text" x="860" y="1665">5. Final tier based on mode:</text>
  <text class="small-text" x="880" y="1685">   • shadow = deterministic (1628)</text>

  <!-- Cost Calculation Flow -->
  <rect class="box" x="110" y="1730" width="700" height="180" />
  <text class="title" x="460" y="1755">COST CALCULATION FLOW (1630)</text>
  
  <text class="small-text" x="140" y="1785">1. Base Rate (1632) × Regional Multiplier (1634)</text>
  <text class="small-text" x="140" y="1810">2. Apply Flag Modifiers cumulatively (1636)</text>
  <text class="small-text" x="160" y="1830">   • Dementia care modifier</text>
  <text class="small-text" x="160" y="1850">   • Mobility assistance modifier</text>
  <text class="small-text" x="160" y="1870">   • Behavioral support modifier</text>
  <text class="small-text" x="140" y="1890">3. Segment: Housing + Care + Carry (1638)</text>

  <!-- Real-Time Update Flow -->
  <rect class="box" x="840" y="1730" width="640" height="180" />
  <text class="title" x="1160" y="1755">REAL-TIME UPDATE FLOW (1640)</text>
  
  <text class="small-text" x="860" y="1785">1. User input change detected (1642)</text>
  <text class="small-text" x="860" y="1810">2. Event triggers calculation engine (1644)</text>
  <text class="small-text" x="860" y="1835">3. Recalculate all costs (&lt;100ms) (1646)</text>
  <text class="small-text" x="860" y="1860">4. Update visualization display (1648)</text>
  <text class="small-text" x="860" y="1885">5. Cache results (30min TTL) (1649)</text>

  <!-- ==================== VERTICAL DATA FLOW ARROWS ==================== -->
  
  <!-- Presentation to Product Layer -->
  <line class="arrow" x1="270" y1="340" x2="270" y2="420" />
  <line class="arrow" x1="620" y1="340" x2="620" y2="420" />
  <line class="arrow" x1="970" y1="340" x2="970" y2="420" />
  <line class="arrow" x1="1320" y1="340" x2="1320" y2="420" />
  
  <!-- Product to Intelligence Layer -->
  <line class="arrow" x1="270" y1="630" x2="270" y2="730" />
  <line class="arrow" x1="620" y1="630" x2="700" y2="730" />
  <line class="arrow" x1="970" y1="630" x2="900" y2="730" />
  <line class="arrow" x1="1320" y1="630" x2="1150" y2="730" />
  
  <!-- Intelligence to Data Layer -->
  <line class="arrow" x1="270" y1="940" x2="270" y2="1040" />
  <line class="arrow" x1="620" y1="940" x2="620" y2="1040" />
  <line class="arrow" x1="970" y1="940" x2="970" y2="1040" />
  <line class="arrow" x1="1265" y1="940" x2="1320" y2="1040" />
  
  <!-- Data to External Layer -->
  <line class="arrow" x1="270" y1="1250" x2="270" y2="1355" />
  <line class="arrow" x1="620" y1="1250" x2="620" y2="1355" />
  <line class="arrow" x1="970" y1="1250" x2="970" y2="1355" />
  <line class="arrow" x1="1320" y1="1250" x2="1320" y2="1355" />

  <!-- Cross-layer interactions -->
  <line class="bi-arrow" x1="1050" y1="835" x2="810" y2="525" />
  <text class="small-text" x="900" y="670">Flag Propagation</text>
  
  <line class="bi-arrow" x1="800" y1="940" x2="800" y2="1040" />
  <text class="small-text" x="815" y="990">State Sync</text>

</svg>