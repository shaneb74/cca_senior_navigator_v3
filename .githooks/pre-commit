#!/usr/bin/env bash
set -euo pipefail

# Senior Navigator pre-commit hook
# (v2025.10.2) – legacy GCP CSV checks deprecated
# Framework retained for future required-file validation.

REQUIRED_FILES=()  # no required files in current release

# Only run the loop if there are entries (safe under `set -u`)
if ((${#REQUIRED_FILES[@]:-0} > 0)); then
  for file in "${REQUIRED_FILES[@]}"; do
    if [[ ! -f "$file" ]]; then
      echo "[pre-commit] Missing required file: $file" >&2
      exit 1
    fi
  done
fi

echo "[pre-commit] Hook executed successfully (no required files enforced)"

# Block any new radio/pill rules from entering CSS files (except modules.css baseline and archives)
CHANGED_CSS=$(git diff --cached --name-only | grep -E '\.css$' | grep -v "modules.css" | grep -v "^archive/" || true)
if [[ -n "$CHANGED_CSS" ]]; then
  if git diff --cached | grep -E '(data-testid="stRadio"|role="radiogroup"|input\[type="radio"\])' >/dev/null; then
    echo
    echo "❌ Blocked: radio/pill styles belong ONLY in core/ui_css.py (inject_pill_css)."
    echo "   Please move any stRadio/radiogroup/radio selectors into ui_css.py."
    echo "   (modules.css and archive/ are exempt)"
    echo
    exit 1
  fi
fi

exit 0
